<!doctype html>
<html class="dark" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Historical Timeline</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
            rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#004a99",
                        "background-dark": "#020617",
                    },
                    fontFamily: {
                        sans: ["Inter", "sans-serif"],
                        display: ["Playfair Display", "serif"],
                    },
                },
            },
        };
    </script>
    <style type="text/tailwindcss">
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-panel {
            background: rgba(2, 6, 23, 0.55);
            backdrop-filter: blur(28px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.10);
            box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
        }

        .year-shadow {
            text-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        }

        main {
            min-height: 120vh; /* ← aquí está el cambio principal: más alto que la pantalla */
            display: flex;
            padding-top: 8rem;
            padding-bottom: 6rem;
        }

        #bg-image {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.55) contrast(1.1) grayscale(0.6);
            transition: opacity 0.8s ease;
            z-index: -2;
            opacity: 0;
        }

        #bg-image.visible {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-background-dark text-slate-100 font-sans overflow-x-hidden">
<img id="bg-image" src="" alt="Background"/>

<div class="fixed inset-0 z-[-1] pointer-events-none">
    <div
            class="absolute inset-0 bg-gradient-to-t from-background-dark via-transparent/30 to-background-dark/60"
    ></div>
    <div
            class="absolute inset-0 bg-gradient-to-r from-background-dark/80 via-transparent/30 to-transparent"
    ></div>
</div>

<header
        class="fixed top-0 left-0 right-0 z-50 bg-background-dark/90 backdrop-blur-xl border-b border-white/10"
>
    <div
            class="max-w-[1440px] mx-auto px-6 py-4 flex items-center justify-between"
    >
        <div
                id="years-nav"
                class="flex items-center space-x-6 md:space-x-10 overflow-x-auto no-scrollbar scroll-smooth flex-1"
        ></div>
    </div>
</header>

<main class="relative">
    <div class="w-full max-w-7xl mx-auto px-6 md:px-12">
        <div
                id="content-card"
                class="max-w-xl glass-panel p-8 md:p-12 lg:p-14 rounded-2xl relative overflow-hidden shadow-2xl"
        >
            <!-- Contenido dinámico -->
        </div>
    </div>

    <div class="fixed bottom-8 right-8 z-50 flex items-center gap-6">
        <div class="flex gap-3">
            <button
                    id="btn-prev"
                    class="w-14 h-14 flex items-center justify-center rounded-xl glass-panel hover:bg-white/10 text-white transition-all disabled:opacity-40 disabled:cursor-not-allowed"
            >
            <span
                    class="material-symbols-outlined group-hover:-translate-x-0.5 transition-transform"
            >chevron_left</span
            >
            </button>
            <button
                    id="btn-next"
                    class="w-14 h-14 flex items-center justify-center rounded-xl glass-panel hover:bg-white/10 text-white transition-all disabled:opacity-40 disabled:cursor-not-allowed"
            >
            <span
                    class="material-symbols-outlined group-hover:translate-x-0.5 transition-transform"
            >chevron_right</span
            >
            </button>
        </div>
    </div>
</main>

<script>
    let timelineData = [];
    let currentIndex = 0;

    async function loadTimeline() {
        try {
            const res = await fetch("data.json");
            const data = await res.json();
            timelineData = data.timeline || [];
            if (!timelineData.length) return;

            generateYearsNav();
            renderCard(currentIndex);
            updateBackground(currentIndex);
            updateButtons();
        } catch (err) {
            console.error(err);
            document.getElementById("content-card").innerHTML =
                '<p class="text-red-400 text-center py-10">Error al cargar datos</p>';
        }
    }

    function generateYearsNav() {
        const nav = document.getElementById("years-nav");
        nav.innerHTML = timelineData
            .map(
                (item, i) => `
      <a href="#" data-index="${i}"
         class="text-sm md:text-base font-medium transition-colors whitespace-nowrap px-2 py-1 ${i === 0 ? "text-primary border-b-2 border-primary" : "text-slate-400 hover:text-white"}">
        ${item.year}
      </a>
    `,
            )
            .join("");

        nav.addEventListener("click", (e) => {
            const a = e.target.closest("a");
            if (!a) return;
            e.preventDefault();
            const idx = parseInt(a.dataset.index);
            currentIndex = idx;
            renderCard(idx);
            updateBackground(idx);
            updateYearsNav();
            updateButtons();
            scrollTo(0, 0);
        });
    }

    function updateYearsNav() {
        document.querySelectorAll("#years-nav a").forEach((el, i) => {
            el.className = `text-sm md:text-base font-medium transition-colors whitespace-nowrap px-2 py-1 ${i === currentIndex ? "text-primary border-b-2 border-primary" : "text-slate-400 hover:text-white"}`;
        });
    }

    function escapeHtml(str = "") {
        return String(str)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
    }

    function renderLinks(item) {
        // Soporta:
        // - item.link (string)
        // - item.sources (array de { label, url } o array de strings)
        const links = [];

        if (item.link && typeof item.link === "string") {
            links.push({ label: "Documento / Fuente", url: item.link });
        }

        if (Array.isArray(item.sources)) {
            item.sources.forEach((s, idx) => {
                if (typeof s === "string") links.push({ label: `Fuente ${idx + 1}`, url: s });
                else if (s?.url) links.push({ label: s.label || `Fuente ${idx + 1}`, url: s.url });
            });
        }

        if (!links.length) return "";

        return `
      <div class="pt-6 flex flex-wrap gap-3">
        ${links
            .map(
                (l) => `
          <a href="${escapeHtml(l.url)}"
             target="_blank"
             rel="noopener noreferrer"
             class="bg-primary hover:bg-primary/85 text-white font-semibold py-3 px-6 rounded-lg transition-all flex items-center gap-2 shadow-lg shadow-primary/30 text-sm md:text-base">
            ${escapeHtml(l.label)}
            <span class="material-symbols-outlined text-[20px]">open_in_new</span>
          </a>
        `,
            )
            .join("")}
      </div>
    `;
    }

    function renderCard(idx) {
        const item = timelineData[idx];
        if (!item) return;

        const impacts = Array.isArray(item.impact) ? item.impact : [];
        const hasMeta =
            item.tool || item.institution || item.legal_scope || item.state;

        // Respeta saltos de línea del JSON (si los usas)
        const descriptionHtml = escapeHtml(item.description || "").replaceAll("\n", "<br/>");

        document.getElementById("content-card").innerHTML = `
      <div class="absolute -top-20 -left-20 w-40 h-40 bg-primary/10 blur-[80px] rounded-full"></div>

      <div class="space-y-7 relative z-10">

        <!-- Header -->
        <div class="flex items-start justify-between gap-6">
          <div>
            <h1 class="text-6xl md:text-8xl font-display font-bold text-white tracking-tight leading-none year-shadow">
              ${escapeHtml(item.year)}
            </h1>
            <div class="flex items-center gap-3 mt-3">
              <div class="h-px w-8 bg-primary"></div>
              <p class="text-xs tracking-[0.3em] font-bold text-slate-400 uppercase">
                ${escapeHtml(item.month || "")}
              </p>
            </div>
          </div>

          <!-- Badges -->
          <div class="flex flex-col items-end gap-2">
            ${item.tool ? `
              <span class="px-3 py-1 rounded-full text-xs font-semibold border border-white/10 bg-white/5 text-slate-200">
                ${escapeHtml(item.tool)}
              </span>` : ""
        }
            ${item.state ? `
              <span class="px-3 py-1 rounded-full text-xs font-semibold border border-white/10 bg-white/5 text-slate-300">
                ${escapeHtml(item.state)}
              </span>` : ""
        }
          </div>
        </div>

        <!-- Title + Description -->
        <div class="space-y-4">
          <h2 class="text-2xl md:text-3xl font-bold text-white leading-tight">
            ${escapeHtml(item.title || "")}
          </h2>

          <div class="text-base leading-relaxed font-light text-slate-300">
            ${descriptionHtml}
          </div>
        </div>

        <!-- Meta grid -->
        ${
            hasMeta
                ? `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pt-2">
            ${item.institution ? `
              <div class="rounded-xl border border-white/10 bg-white/5 p-4">
                <p class="text-xs uppercase tracking-wider text-slate-400">Institución</p>
                <p class="mt-1 text-sm text-slate-200">${escapeHtml(item.institution)}</p>
              </div>` : ""
                }
            ${item.legal_scope ? `
              <div class="rounded-xl border border-white/10 bg-white/5 p-4">
                <p class="text-xs uppercase tracking-wider text-slate-400">Alcance</p>
                <p class="mt-1 text-sm text-slate-200">${escapeHtml(item.legal_scope)}</p>
              </div>` : ""
                }
          </div>
        `
                : ""
        }

        <!-- Impact -->
        ${
            impacts.length
                ? `
          <div class="pt-2">
            <div class="flex items-center gap-2 mb-3">
              <span class="material-symbols-outlined text-primary">bolt</span>
              <h3 class="text-sm font-bold tracking-wide text-white uppercase">Impacto</h3>
            </div>

            <ul class="space-y-2">
              ${impacts
                    .map(
                        (t) => `
                <li class="flex items-start gap-3">
                  <span class="material-symbols-outlined mt-[2px] text-primary">check_circle</span>
                  <span class="text-sm text-slate-200 leading-relaxed">${escapeHtml(t)}</span>
                </li>
              `,
                    )
                    .join("")}
            </ul>
          </div>
        `
                : ""
        }

        <!-- Links -->
        ${renderLinks(item)}
      </div>
    `;
    }

    function updateBackground(idx) {
        const bg = document.getElementById("bg-image");
        const src = timelineData[idx]?.image || "";

        if (!src) return;

        bg.classList.remove("visible");
        setTimeout(() => {
            bg.src = src;
            bg.onload = () => bg.classList.add("visible");
        }, 300);
    }

    function updateButtons() {
        document.getElementById("btn-prev").disabled = currentIndex === 0;
        document.getElementById("btn-next").disabled =
            currentIndex === timelineData.length - 1;
    }

    document.getElementById("btn-prev").addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            renderCard(currentIndex);
            updateBackground(currentIndex);
            updateYearsNav();
            updateButtons();
            scrollTo(0, 0);
        }
    });

    document.getElementById("btn-next").addEventListener("click", () => {
        if (currentIndex < timelineData.length - 1) {
            currentIndex++;
            renderCard(currentIndex);
            updateBackground(currentIndex);
            updateYearsNav();
            updateButtons();
            scrollTo(0, 0);
        }
    });

    loadTimeline();
</script>
</body>
</html>
